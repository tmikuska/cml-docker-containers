#
# {{DESC}} node definition
# generated {{DATE}}
# part of VIRL^2
#

id: {{NAME}}
configuration:
  generator:
    driver: server
  provisioning:
    volume_name: cfg
    media_type: raw
    files:
      - name: config.json
        editable: false
        content: |
          {
            "docker": {
              "image": "{{IMAGENAMETAG}}",
              "mounts": [
                "type=bind,source=cfg/boot.sh,target=/boot.sh",
                "type=bind,source=cfg/radiusd.conf,target=/etc/freeradius/3.0/radiusd.conf",
                "type=bind,source=cfg/users,target=/etc/freeradius/3.0/mods-config/files/authorize"
              ]
            },
            "shell": "/bin/bash",
            "day0cmd": [ "/bin/bash", "/boot.sh" ],
            "busybox": true
          }
      - name: radiusd.conf
        editable: true
        content: |
          # Basic freeRADIUS onfiguration

          prefix = /usr
          exec_prefix = /usr
          sysconfdir = /etc
          localstatedir = /var
          sbindir = ${exec_prefix}/sbin
          logdir = /var/log/freeradius
          raddbdir = /etc/freeradius/3.0
          radacctdir = ${logdir}/radacct
          name = freeradius
          confdir = ${raddbdir}
          modconfdir = ${confdir}/mods-config
          certdir = ${confdir}/certs
          cadir   = ${confdir}/certs
          run_dir = ${localstatedir}/run/${name}
          db_dir = ${raddbdir}
          libdir = /usr/lib/freeradius
          pidfile = ${run_dir}/${name}.pid
          max_request_time = 30
          cleanup_delay = 5
          max_requests = 16384
          hostname_lookups = no

          log {
              destination = syslog
              colourise = yes
              file = ${logdir}/radius.log
              syslog_facility = daemon
              stripped_names = no
              auth = yes
              auth_reject = yes
              auth_badpass = yes
              auth_goodpass = yes
              msg_denied = "You are already logged in - access denied"
          }

          checkrad = ${sbindir}/checkrad

          #ENV {
          #}

          security {
              user = freerad
              group = freerad
              allow_core_dumps = no
              max_attributes = 200
              reject_delay = 1
              status_server = yes
          }

          proxy_requests = no
          #$INCLUDE proxy.conf

          #$INCLUDE clients.conf
          client all-devices {
              ipaddr = *
              secret = geheim
              require_message_authenticator = no
              nas_type = cisco
          }

          thread pool {
              start_servers = 5
              max_servers = 32
              min_spare_servers = 3
              max_spare_servers = 10
              max_requests_per_server = 0
              auto_limit_acct = no
          }

          modules {
              $INCLUDE mods-enabled/
          }

          #instantiate {
          #}

          policy {
              $INCLUDE policy.d/
          }

          $INCLUDE sites-enabled/
      - name: users
        editable: true
        content: |
          # https://wiki.freeradius.org/guide/Basic-configuration-HOWTO
          # https://github.com/FreeRADIUS/freeradius-server/blob/v3.0.x/raddb/mods-config/files/authorize
          testuser Cleartext-Password := "testpassword"
      - name: environment
        content: |-
          # Create additional environment variables
          # run freeradius with -X (for debugging)
          # be sure to use no quotes around the string (even if it contains
          # spaces)!
          #
          # A copy of the logfile can be found in /var/log/freeradius
          #
          # ARGS=-f -lstdout
          # ARGS=-X
        editable: true
      - name: boot.sh
        editable: true
        content: |
          # insert more commands here
          # ip address add dev eth0 10.0.0.1/24
          # ip link set dev eth0 up
          exit 0
      - name: mounts
        content: |-
          # Can map a volume with radius server data into the container
          # it. By default, only type=volume is allowed, see
          # /etc/default/docker-shim.env
          # Note: Volumes must exist to be usable and can be created via
          # "docker volume create radiusdata" where radiusdata is the name
          #
          # type=volume,source=radiusdata,target=/var/somedir
        editable: true
device:
  interfaces:
    has_loopback_zero: false
    min_count: 1
    default_count: 4
    management:
      - eth0
    physical:
      - eth0
      - eth1
      - eth2
      - eth3
    serial_ports: 2
inherited:
  image:
    ram: true
    cpus: true
    cpu_limit: true
    data_volume: false
    boot_disk_size: false
  node:
    ram: true
    cpus: true
    cpu_limit: true
    data_volume: false
    boot_disk_size: false
general:
  description: {{DESC}} (Docker)
  nature: server
  read_only: true
schema_version: 0.0.1
sim:
  linux_native:
    cpus: 1
    ram: 512
    driver: server
    libvirt_domain_driver: docker
    cpu_limit: 100
boot:
  timeout: 30
  completed:
    - Ready to process requests
ui:
  description: |
    {{FULLDESC}}
  group: Others
  icon: server
  label: Radius
  label_prefix: radius-
  visible: true
